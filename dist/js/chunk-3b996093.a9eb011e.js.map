{"version":3,"sources":["webpack:///./src/assets/images/icon-position.svg","webpack:///./src/views/Map.vue","webpack:///./src/components/Search.vue","webpack:///./src/components/Search.vue?4219","webpack:///./src/views/Map.vue?506b","webpack:///./src/views/Map.vue?aef9","webpack:///./src/components/Search.vue?ef1a"],"names":["module","exports","id","class","src","alt","geoBtn","type","placeholder","aria-label","aria-describedby","xmlns","width","height","fill","viewBox","d","data","__exports__","components","Search","mymap","nowLocation","latitude","longitude","apiStation","apiBike","methods","navigator","geolocation","getCurrentPosition","position","console","log","coords","error","message","getMap","this","map","setView","tileLayer","attribution","maxZoom","username","style_id","tileSize","zoomOffset","accessToken","addTo","control","zoom","getApiStation","urlStation","$http","get","headers","apiID","then","res","catch","response","getApiBike","urlBike","dataBike","forEach","bikeItem","stationItem","StationUID","StationName","StationPosition","StationAddress","StopDescription","BikesCapacity","push","setMarker","AppID","AppKey","GMTString","Date","toGMTString","ShaObj","setHMACKey","update","HMAC","getHMAC","Authorization","item","MyIcon","DivIcon","html","AvailableRentBikes","className","iconSize","marker","PositionLat","PositionLon","icon","watch","handler","n","deep","mounted","render"],"mappings":"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","file":"js/chunk-3b996093.a9eb011e.js","sourcesContent":["module.exports = __webpack_public_path__ + \"img/icon-position.cf4fae51.svg\";","<template>\n  <div id=\"mapid\" class=\"mapid\"></div>\n  <Search></Search>\n  <button\n    @click=\"geoBtn\"\n    type=\"button\" class=\"pos-btn btn btn-dark rounded-circle\">\n    <img src=\"@/assets/images/icon-position.svg\" alt=\"position icon\">\n  </button>\n</template>\n\n<style lang=\"scss\">\n  .mapid {\n    position: absolute;\n    height: 100vh;\n    width: 100vw;\n    left: 0;\n  }\n  .leaflet-touch .leaflet-control-layers, .leaflet-touch .leaflet-bar {\n    border: none;\n  }\n  .leaflet-bar {\n    a {\n      background-color: #213649;\n      border: none;\n      color: #B5B2A6;\n    }\n  }\n  .leaflet-touch .leaflet-bar a:first-child {\n    border-radius: 16px 16px 0 0;\n    margin-bottom: 6px;\n    height: 40px;\n    width: 40px;\n  }\n  .leaflet-touch .leaflet-bar a:last-child {\n    border-radius: 0 0 16px 16px;\n    height: 40px;\n    width: 40px;\n  }\n  .pos-btn {\n    position: absolute;\n    z-index: 1100;\n    right: 34px;\n    bottom: 123px;\n    width: 40px;\n    height: 40px;\n    img {\n      position: absolute;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n    }\n    &:hover {\n      background-color: #f4f4f4;\n      border-color: #f4f4f4;\n      img {\n        filter: brightness(0);\n      }\n    }\n  }\n  .leafletIcon {\n    background-image: url('../assets/images/marker.svg');\n    background-size: contain;\n    background-repeat: no-repeat;\n    text-align: center;\n    .number {\n      font-size: 14px;\n      line-height: 36px;\n    }\n  }\n</style>\n\n<script>\nimport L from 'leaflet'\nimport Search from '@/components/Search.vue'\nimport JsSHA from 'jssha'\n\nexport default {\n  components: {\n    Search\n  },\n  data () {\n    return {\n      mymap: null,\n      nowLocation: {\n        latitude: 25.047675,\n        longitude: 121.517055\n      },\n      apiStation: [],\n      // apiStation 只有租借站位資料\n      apiBike: []\n      // apiBike 即時車位加入租借站資料\n    }\n  },\n  methods: {\n    // 取得當下位置\n    geoBtn () {\n      if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(position => {\n          console.log(position.coords.latitude)\n          console.log(position.coords.longitude)\n          // 重新定位\n          this.nowLocation.latitude = position.coords.latitude\n          this.nowLocation.longitude = position.coords.longitude\n        },\n        error => {\n          console.log(error.message)\n        })\n      } else {\n        console.log('Your browser does not support geolocation API')\n      }\n    },\n    getMap () {\n      this.mymap = L.map('mapid').setView([this.nowLocation.latitude, this.nowLocation.longitude], 15)\n\n      L.tileLayer('https://api.mapbox.com/styles/v1/{username}/{style_id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\n        attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n        maxZoom: 18,\n        username: 'unayo',\n        style_id: 'ckw6oruov0sl614pinxf6eb44',\n        tileSize: 512,\n        zoomOffset: -1,\n        accessToken: 'pk.eyJ1IjoidW5heW8iLCJhIjoiY2t1d2EwNzZpMGh2aDJ3cmYwdWJnb2hudyJ9.XcnKuVJN2Q50urzdA594WQ'\n      }).addTo(this.mymap)\n\n      L.control.zoom({\n        position: 'bottomright'\n      }).addTo(this.mymap)\n    },\n    getApiStation () {\n      // 取得指定[位置,範圍]的全臺公共自行車租借站位資料\n      const urlStation = `https://ptx.transportdata.tw/MOTC/v2/Bike/Station/NearBy?$top=30&$spatialFilter=nearby(${this.nowLocation.latitude}, ${this.nowLocation.longitude}, 1000)&$format=JSON`\n      this.$http.get(urlStation,\n        {\n          headers: this.apiID()\n        })\n        .then((res) => {\n          this.apiStation = res.data\n          // console.log('全臺公共自行車租借站位資料', this.apiStation)\n        })\n        .catch(error => {\n          console.log('error', error.response)\n        })\n    },\n    getApiBike () {\n      this.getApiStation()\n      // 全臺公共自行車即時車位資料\n      const urlBike = `https://ptx.transportdata.tw/MOTC/v2/Bike/Availability/NearBy?$top=30&$spatialFilter=nearby(${this.nowLocation.latitude}, ${this.nowLocation.longitude}, 1000)&$format=JSON`\n      this.$http.get(urlBike,\n        {\n          headers: this.apiID()\n        })\n        .then((res) => {\n          const dataBike = res.data\n          // 比對 id 在即時車位加入租借站位資料\n          dataBike.forEach((bikeItem) => {\n            this.apiStation.forEach((stationItem) => {\n              if (bikeItem.StationUID === stationItem.StationUID) {\n                bikeItem.StationName = stationItem.StationName\n                bikeItem.StationPosition = stationItem.StationPosition\n                bikeItem.StationAddress = stationItem.StationAddress\n                bikeItem.StopDescription = stationItem.StopDescription\n                bikeItem.BikesCapacity = stationItem.BikesCapacity\n                this.apiBike.push(bikeItem)\n              }\n            })\n          })\n          console.log('總和 api 資料', this.apiBike)\n          // 串接後，綁上 marker\n          this.setMarker()\n        })\n    },\n    apiID () {\n      // TDX API 驗證\n      const AppID = process.env.VUE_APP_ID\n      const AppKey = process.env.VUE_APP_KEY\n      const GMTString = new Date().toGMTString()\n      const ShaObj = new JsSHA('SHA-1', 'TEXT')\n      ShaObj.setHMACKey(AppKey, 'TEXT')\n      ShaObj.update('x-date: ' + GMTString)\n      const HMAC = ShaObj.getHMAC('B64')\n      const Authorization = `hmac username=\"${AppID}\", algorithm=\"hmac-sha1\", headers=\"x-date\", signature=\"${HMAC}\"`\n      return { Authorization: Authorization, 'X-Date': GMTString }\n    },\n    setMarker () {\n      this.apiBike.forEach((item) => {\n        const MyIcon = new L.DivIcon({\n          html: `<span class=\"number\">${item.AvailableRentBikes}</span>`,\n          className: 'leafletIcon',\n          iconSize: [36, 44]\n        })\n        // [先緯度, 後經度]\n        L.marker([item.StationPosition.PositionLat, item.StationPosition.PositionLon], { icon: MyIcon }).addTo(this.mymap)\n      })\n    }\n  },\n  watch: {\n    nowLocation: {\n      handler (n) {\n        this.mymap.setView([n.latitude, n.longitude], 17)\n        this.getApiBike()\n        console.log('new', n)\n      },\n      deep: true\n    }\n  },\n  mounted () {\n    this.getMap()\n    this.geoBtn()\n    this.getApiBike()\n  }\n}\n</script>\n","<template>\n  <div class=\"search-box rounded-3 bg-dark position-relative\">\n    <div class=\"d-flex\">\n      <h5 class=\"me-3 text-secondary\">下班後來兜風，找單車站 . . .</h5>\n      <img alt=\"bike\" src=\"@/assets/images/icon_bike.svg\">\n    </div>\n    <div class=\"d-flex my-3\">\n      <input type=\"text\" class=\"form-control me-2 shadow-sm\" placeholder=\"請輸入單車站\" aria-label=\"bike station\" aria-describedby=\"search\">\n      <button class=\"btn btn-primary shadow\" type=\"button\" id=\"search\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-search\" viewBox=\"0 0 16 16\">\n          <path d=\"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z\"/>\n        </svg>\n      </button>\n    </div>\n    <div>\n      <button class=\"tag rounded-pill btn btn-outline-info\">市政府</button>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\">\n  .search-box {\n    max-width: 452px;\n    padding: 24px;\n    z-index: 1100;\n    margin: 40px;\n  }\n  .tag {\n    font-size: 14px;\n    padding: 4px 14px;\n  }\n</style>\n\n<script>\nexport default {\n  data () {\n    return {\n    }\n  }\n}\n</script>\n","import { render } from \"./Search.vue?vue&type=template&id=dc5dc2d2\"\nimport script from \"./Search.vue?vue&type=script&lang=js\"\nexport * from \"./Search.vue?vue&type=script&lang=js\"\n\nimport \"./Search.vue?vue&type=style&index=0&id=dc5dc2d2&lang=scss\"\n\nimport exportComponent from \"/Users/pine_yu/Documents/my project/bike/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Map.vue?vue&type=template&id=4c57b1a6\"\nimport script from \"./Map.vue?vue&type=script&lang=js\"\nexport * from \"./Map.vue?vue&type=script&lang=js\"\n\nimport \"./Map.vue?vue&type=style&index=0&id=4c57b1a6&lang=scss\"\n\nimport exportComponent from \"/Users/pine_yu/Documents/my project/bike/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Map.vue?vue&type=style&index=0&id=4c57b1a6&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Search.vue?vue&type=style&index=0&id=dc5dc2d2&lang=scss\""],"sourceRoot":""}